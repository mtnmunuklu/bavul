package models

import (
	"time"

	"github.com/mtnmunuklu/bavul/pb"
	"github.com/mtnmunuklu/bavul/vulnerability/util"
	"gopkg.in/mgo.v2/bson"
)

// CVE model represents a Common Vulnerabilities and Exposures entry
type CVE struct {
	Id          bson.ObjectId `bson:"_id"`
	CveId       string        `bson:"cve_id"`
	Description string        `bson:"description"`
	Severity    string        `bson:"severity"`
	Product     string        `bson:"product"`
	Vendor      string        `bson:"vendor"`
	Links       []string      `bson:"links"`
	Published   time.Time     `bson:"published"`
	Modified    time.Time     `bson:"modified"`
}

// ToProto converts the CVE model to the corresponding Protobuf message.
func (cve *CVE) ToProto() *pb.CVE {
	return &pb.CVE{
		Id:          cve.Id.Hex(),
		CveId:       cve.CveId,
		Description: cve.Description,
		Severity:    cve.Severity,
		Product:     cve.Product,
		Vendor:      cve.Vendor,
		Links:       cve.Links,
		Published:   util.FormatTime(cve.Published),
		Modified:    util.FormatTime(cve.Modified),
	}
}

// FromProto converts the Protobuf message to the corresponding CVE model.
func (cve *CVE) FromProto(proto *pb.CVE) {
	cve.Id = bson.ObjectIdHex(proto.GetId())
	cve.CveId = proto.CveId
	cve.Description = proto.Description
	cve.Severity = proto.Severity
	cve.Product = proto.Product
	cve.Vendor = proto.Vendor
	cve.Links = proto.Links
	cve.Published = util.ParseTime(proto.Published)
	cve.Modified = util.ParseTime(proto.Modified)
}
